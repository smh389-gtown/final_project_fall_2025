{% extends "bootstrap_5_layout.html" %}
{% set active_page = "game" %}

{% block content %}
<style>
  .movie-card {
    position: relative;
    overflow: hidden;
  }

  /* Make posters smaller so both fit without scrolling */
  .movie-poster {
    max-height: 320px;     /* tweak if you want: 260–360 */
    width: auto;
    object-fit: contain;
    margin: 0 auto;
    display: block;
    background: #f8f9fa;
  }

  /* Rating circle badge shown AFTER guess */
  .rating-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    width: 56px;
    height: 56px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.05rem;
    box-shadow: 0 6px 18px rgba(0,0,0,0.18);
    border: 2px solid rgba(255,255,255,0.9);
    backdrop-filter: blur(3px);
  }
  .rating-a { background: rgba(13, 110, 253, 0.95); color: #fff; }   /* bootstrap primary-ish */
  .rating-b { background: rgba(25, 135, 84, 0.95); color: #fff; }    /* bootstrap success-ish */

  /* Optional: show delta circle in the middle after guess */
  .delta-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 64px;
    height: 38px;
    padding: 0 14px;
    border-radius: 999px;
    font-weight: 700;
    box-shadow: 0 6px 18px rgba(0,0,0,0.12);
  }
</style>

<div class="container py-4">

  <h2 class="text-center mb-4">
    Which movie has the higher TMDB rating?
  </h2>

  {% if result %}
    {% set a_rating = movie_a.rating %}
    {% set b_rating = movie_b.rating %}
    {% set diff = (a_rating - b_rating) | abs %}

    {% if result.is_correct %}
      <div class="alert alert-success text-center" role="alert">
        ✅ Correct! The higher-rated movie was <strong>{{ result.correct }}</strong>.
        <div class="mt-2">
          <span class="delta-badge bg-dark text-white">
            Δ {{ "%.1f"|format(diff) }}
          </span>
        </div>
      </div>
    {% else %}
      <div class="alert alert-danger text-center" role="alert">
        ❌ Not quite.
        {% if result.correct %}
          The higher-rated movie was <strong>{{ result.correct }}</strong>.
        {% else %}
          It was a tie — try a new round!
        {% endif %}
        <div class="mt-2">
          <span class="delta-badge bg-dark text-white">
            Δ {{ "%.1f"|format(diff) }}
          </span>
        </div>
      </div>
    {% endif %}
  {% endif %}

  <div class="row justify-content-center">

    <!-- Movie A -->
    <div class="col-md-5">
      <div class="card h-100 text-center shadow-sm movie-card">

        {% if result %}
          <div class="rating-badge rating-a" title="TMDB rating">
            {{ "%.1f"|format(movie_a.rating) }}
          </div>
        {% endif %}

        <a href="{{ movie_a.page_url }}" target="_blank" rel="noopener">
          <img
            src="{{ movie_a.poster_url }}"
            class="card-img-top movie-poster"
            alt="{{ movie_a.title }}"
          >
        </a>

        <div class="card-body">
          <h5 class="card-title">
            <a href="{{ movie_a.page_url }}" target="_blank" rel="noopener" class="text-decoration-none">
              {{ movie_a.title }}
            </a>
          </h5>

          {% if not result %}
            <form method="post" action="{{ url_for('game.guess') }}">
              <input type="hidden" name="choice" value="A">
              <button type="submit" class="btn btn-primary w-100">
                Choose This Movie
              </button>
            </form>
          {% else %}
            <button class="btn btn-secondary w-100" disabled>
              Choose This Movie
            </button>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- VS divider -->
    <div class="col-md-2 d-flex align-items-center justify-content-center">
      <div class="text-center">
        <h1 class="fw-bold mb-2">VS</h1>
        {% if result %}
          {% set diff = (movie_a.rating - movie_b.rating) | abs %}
          <span class="badge bg-dark px-3 py-2" style="font-size: 1rem;">
            Δ {{ "%.1f"|format(diff) }}
          </span>
        {% endif %}
      </div>
    </div>

    <!-- Movie B -->
    <div class="col-md-5">
      <div class="card h-100 text-center shadow-sm movie-card">

        {% if result %}
          <div class="rating-badge rating-b" title="TMDB rating">
            {{ "%.1f"|format(movie_b.rating) }}
          </div>
        {% endif %}

        <a href="{{ movie_b.page_url }}" target="_blank" rel="noopener">
          <img
            src="{{ movie_b.poster_url }}"
            class="card-img-top movie-poster"
            alt="{{ movie_b.title }}"
          >
        </a>

        <div class="card-body">
          <h5 class="card-title">
            <a href="{{ movie_b.page_url }}" target="_blank" rel="noopener" class="text-decoration-none">
              {{ movie_b.title }}
            </a>
          </h5>

          {% if not result %}
            <form method="post" action="{{ url_for('game.guess') }}">
              <input type="hidden" name="choice" value="B">
              <button type="submit" class="btn btn-primary w-100">
                Choose This Movie
              </button>
            </form>
          {% else %}
            <button class="btn btn-secondary w-100" disabled>
              Choose This Movie
            </button>
          {% endif %}
        </div>
      </div>
    </div>

  </div>

  {% if result %}
    <div class="text-center mt-4">
      <form method="post" action="{{ url_for('game.next_round') }}">
        <button type="submit" class="btn btn-success px-4">
          Next Round
        </button>
      </form>
      <p class="text-muted mt-2 mb-0" style="font-size: 0.95rem;">
        Posters/titles open the TMDB page in a new tab.
      </p>
    </div>
  {% endif %}

</div>
{% endblock %}
